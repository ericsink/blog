---
layout: post
esbma_id: 1788
title: Veracity Technology Overview
date: 2010-07-19 20:13:45
---
<p>When I encounter a new piece of software, I usually ask,
"What's in it?"</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td colspan=2 valign=top style='border:solid windowtext 1.0pt;background:
  #D9D9D9;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p align=center style='text-align:center'><b>Tools and
  technologies we've been using to build Veracity</b></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>C</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>The core library and the command-line app are written
  entirely in C.&nbsp; Some folks won't like our coding conventions.&nbsp; I'll probably
  do a whole blog entry sometime to ((apologize for) &amp;&amp; (defend)) the
  liberties we've taken with the C preprocessor.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>JavaScript</p>
  <p>jQuery</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>On the browser side of things, Veracity is a web app
  written in JavaScript using jQuery. </p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>SVG</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Burn down charts and other web graphics are done using
  SVG.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>JSON</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Veracity uses JSON all over the place.&nbsp; All serialized
  structures in the repo are JSON.&nbsp; Database records and templates are JSON.&nbsp;
  We have a bunch of C code for parsing JSON, writing JSON, and dealing with JSON-like
  data in memory.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>SQLite</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>We use SQLite in several places as a more scalable disk
  format, and also as an index. </p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Mongoose</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>The Veracity command-line app has an embedded web server
  for personal use.&nbsp; It's based on Mongoose.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Curl</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>The client side of push/pull is done by calling libcurl.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>UTF-8</p>
  <p>ICU</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Early on in the Veracity project, we did a lot of work to
  make sure that stuff was done right with respect to Unicode.&nbsp; Our preferred
  encoding is UTF-8.&nbsp; The ICU library from IBM has been helpful in a number of
  places.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>REST</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>The Veracity web API is very RESTy.&nbsp; And of course,
  everything serialized over the network is in JSON.&nbsp; </p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>CMake</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Our build system is CMake, with which we have a love/hate
  relationship.&nbsp; We love it because it generates makefiles, Xcode projects or
  Visual Studio solutions.&nbsp; We hate it because its language makes Forth look
  sane.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>CTest</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>We have a huge suite of automated tests.&nbsp; CMake's
  integrated test stuff actually works pretty well.&nbsp; Just run 'ctest' at the
  top level directory.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>SpiderMonkey</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>A lot of our tests are written in Javascript.&nbsp; We have a
  command-line executable called 'vscript' which is basically the Spidermonkey
  Javascript engine glued to the main Veracity library.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Continuous Integration</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Our CI system system rebuilds from scratch and runs the
  main tests after every checkin, on Mac, Linux and Windows.&nbsp; Results are
  published to an internal web page and sent to the team by email.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Scrum</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>The more we use Scrum, the more I like it.&nbsp; We're patient
  with ourselves.&nbsp; We just try to get a little better in our Scrum practices
  each iteration.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>gcov</p>
  <p>lcov</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Nightly builds run the entire test suite with code
  coverage done by gcov.&nbsp; Our current coverage level is 81%.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>vcdiff</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>For binary deltas, Veracity uses the algorithm described
  in RFC 3284.&nbsp; (Actually, the use of binary deltas is currently turned off by
  default, so if you notice that repositories seem big, that's why.&nbsp; All the
  plumbing is done.&nbsp; We're just not using it yet.)&nbsp; Anyway, we've got our own
  implementation of vcdiff.&nbsp; We may consider switching to Google's open-vcdiff
  at some point if its performance is better.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>zlib</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>For simple non-deltified compression in repo
  implementations, Veracity uses zlib.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Valgrind</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>When coding in C, valgrind is indispensable.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Shark</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>I do most of my coding on the Mac, so I use the Shark
  profiler.&nbsp; Very cool.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>emacs</p>
  <p>vim</p>
  <p>Eclipse</p>
  <p>Visual Studio</p>
  <p>bash</p>
  <p>gdb</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Every developer on our team chooses their own tools.&nbsp; We
  have a good representation of most of the major religions.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Firefox</p>
  <p>Safari</p>
  <p>Chrome</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Similarly, every developer chooses their own web browser.&nbsp;
  I'm not sure what feelings to have upon noticing that nobody is using
  Internet Explorer.&nbsp; It seems so wrong. &nbsp;And yet, so right.</p>
  </td>
 </tr>
 <tr>
  <td colspan=2 valign=top style='border:solid windowtext 1.0pt;border-top:
  none;background:#D9D9D9;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p align=center style='text-align:center'><b>A few notable
  things we'll probably be using later</b></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>.NET</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Even though Veracity was not built fundamentally on the
  .NET platform, we are committed to providing excellent support for Windows
  developers.&nbsp; Visual Studio integration is a high priority.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Java</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Similarly, we didn't use Java to build the core libraries
  for Veracity, but we plan to deliver excellent integration into the Java
  world, including an Eclipse plugin.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>IIS</p>
  <p>Apache</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>The embedded web server is fine for personal use on the
  desktop, but large teams will want to run a real web server for their central
  repository.&nbsp; We designed for this case early, but have not yet implemented
  something like an IIS plugin. </p>
  </td>
 </tr>
 <tr>
  <td colspan=2 valign=top style='border:solid windowtext 1.0pt;border-top:
  none;background:#D9D9D9;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p align=center style='text-align:center'><b>A few notable
  things we are NOT using (and maybe never will)</b></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>C++</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Here's another blog article I need to write.&nbsp; Basically,
  we only considered two choices:&nbsp; C, and the C-like subset of C++.&nbsp; We chose
  plain C.&nbsp; I just wish the Microsoft C compiler supported C99.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Flash</p>
  <p>Silverlight</p>
  <p>GWT</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>We seriously considered other ways of building our web
  apps.&nbsp; We ended up choosing basic HTML/CSS/jQuery/Ajax.&nbsp; No regrets, but I
  sometimes wonder how things are going for people using GWT.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>NSPR</p>
  <p>APR</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>Sorry folks, in an apparent fit of NIH syndrome, we wrote
  our own portability layer. And I am completely unrepentant.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>XML</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p>JSON won.&nbsp; What can I say?&nbsp; I just like curly braces a lot
  more than angle brackets.</p>
  </td>
 </tr>
</table>

<p>&nbsp;</p>